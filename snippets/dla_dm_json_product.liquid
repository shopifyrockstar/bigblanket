{% capture product_json %}{{ dm_orig_product | json }}{% endcapture %}{% capture variants_orig %}"variants":{{ dm_orig_product.variants | json }}{% endcapture %}{% assign product_json = product_json | replace: variants_orig, '***VARIANTS***' %}{% capture price_orig %}"price":{{ dm_orig_product.price }}{% endcapture %}{% capture price_new %}"price":{% render 'dla_dm_product_price_min', dm_orig_product: dm_orig_product %}{% endcapture %}{% assign product_json = product_json | replace: price_orig, price_new %}{% capture price_min_orig %}"price_min":{{ dm_orig_product.price_min }}{% endcapture %}{% capture price_min_new %}"price_min":{% render 'dla_dm_product_price_min', dm_orig_product: dm_orig_product %}{% endcapture %}{% assign product_json = product_json | replace: price_min_orig, price_min_new %}{% capture price_max_orig %}"price_max":{{ dm_orig_product.price_max }}{% endcapture %}{% capture price_max_new %}"price_max":{% render 'dla_dm_product_price_max', dm_orig_product: dm_orig_product %}{% endcapture %}{% assign product_json = product_json | replace: price_max_orig, price_max_new %}{% if dm_orig_product.compare_at_price != null %}{% capture compare_at_orig %}"compare_at_price":{{ dm_orig_product.compare_at_price }}{% endcapture %}{% else %}{% assign compare_at_orig = '"compare_at_price":null' %}{% endif %}{% capture compare_at_new %}"compare_at_price":{% render 'dla_dm_product_compare_at_min', dm_orig_product: dm_orig_product %}{% endcapture %}{% assign product_json = product_json | replace: compare_at_orig, compare_at_new %}{% capture compare_at_min_orig %}"compare_at_price_min":{{ dm_orig_product.compare_at_price_min }}{% endcapture %}{% capture compare_at_min_new %}"compare_at_price_min":{% render 'dla_dm_product_compare_at_min', dm_orig_product: dm_orig_product %}{% endcapture %}{% assign product_json = product_json | replace: compare_at_min_orig, compare_at_min_new %}{% capture compare_at_max_orig %}"compare_at_price_max":{{ dm_orig_product.compare_at_price_max }}{% endcapture %}{% capture compare_at_max_new %}"compare_at_price_max":{% render 'dla_dm_product_compare_at_max', dm_orig_product: dm_orig_product %}{% endcapture %}{% assign product_json = product_json | replace: compare_at_max_orig, compare_at_max_new %}{% capture variants_new %}"variants":[{% for variant in dm_orig_product.variants %}{% render 'dla_dm_json_variant', dm_orig_variant: variant, dm_orig_product: dm_orig_product %}{% unless forloop.last == true %},{% endunless %}{% endfor %}]{% endcapture %}{% assign product_json = product_json | replace: '***VARIANTS***', variants_new %}{{ product_json }}