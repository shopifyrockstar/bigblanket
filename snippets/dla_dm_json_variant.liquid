{% capture variant_json %}{{ dm_orig_variant | json }}{% endcapture %}{% capture price_orig %}"price":{{ dm_orig_variant.price }}{% endcapture %}{% capture price_new %}"price":{% render 'dla_dm_variant_price', dm_rounding: true, dm_orig_product: dm_orig_product, dm_orig_variant: dm_orig_variant %}{% endcapture %}{% assign variant_json = variant_json | replace: price_orig, price_new %}{% if dm_orig_variant.compare_at_price != null %}{% capture compare_at_orig %}"compare_at_price":{{ dm_orig_variant.compare_at_price }}{% endcapture %}{% else %}{% assign compare_at_orig = '"compare_at_price":null' %}{% endif %}{% capture compare_at_new %}"compare_at_price":{% render 'dla_dm_variant_compare_at', dm_orig_product: dm_orig_product, dm_orig_variant: dm_orig_variant %}{% endcapture %}{% assign variant_json = variant_json | replace: compare_at_orig, compare_at_new %}{{ variant_json }}